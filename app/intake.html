<!--/app/intake.html-->
<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tax Monitor Pro — Intake</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet">

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/assets/favicon.ico" sizes="any">
  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
  <link rel="apple-touch-icon" href="/assets/favicon.ico">

  <!-- Flatpickr (themed calendar popup) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <style>
    body { box-sizing: border-box; }
    * { font-family: 'DM Sans', sans-serif; }
    .gradient-text {
      background: linear-gradient(135deg, #F59E0B, #D97706);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
  </style>

  <style>
    /* Flatpickr theme (dark + amber) */
    .flatpickr-calendar {
      background: rgba(2, 6, 23, 0.98);
      border: 1px solid rgba(148, 163, 184, 0.25);
      border-radius: 16px;
      box-shadow: 0 18px 60px rgba(0, 0, 0, 0.55);
      color: rgba(241, 245, 249, 0.92);
      font-family: 'DM Sans', sans-serif;
    }

    .flatpickr-current-month,
    .flatpickr-weekday {
      color: rgba(226, 232, 240, 0.9);
    }

    .flatpickr-day {
      border-radius: 12px;
      color: rgba(241, 245, 249, 0.88);
    }

    .flatpickr-day:hover {
      background: rgba(245, 158, 11, 0.12);
      border-color: rgba(245, 158, 11, 0.25);
    }

    .flatpickr-day.selected,
    .flatpickr-day.startRange,
    .flatpickr-day.endRange {
      background: linear-gradient(135deg, #F59E0B, #D97706);
      border-color: rgba(245, 158, 11, 0.35);
      color: rgba(2, 6, 23, 0.98);
    }

    .flatpickr-months .flatpickr-prev-month,
    .flatpickr-months .flatpickr-next-month {
      color: rgba(226, 232, 240, 0.8);
    }
  </style>

  <style>
    /* Progress (inline-safe, matches theme) */
    .tm-progress-fill { transition: width 220ms ease; }

    .tm-step--active .tm-step-label,
    .tm-step--active .tm-step-num { color: #f59e0b; }

    .tm-step--active .tm-step-num { border-color: rgba(245, 158, 11, 0.55); }

    .tm-step--done { opacity: 0.92; }

    .tm-step--done .tm-step-num {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.22);
      color: rgba(241, 245, 249, 0.92);
    }

    .tm-step--done .tm-step-label { color: rgba(241, 245, 249, 0.92); }
  </style>

  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
</head>

<body class="h-full bg-slate-950 text-slate-100">
  <div id="app" class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="sticky top-0 z-50 border-b border-slate-800/60 bg-slate-950/70 backdrop-blur">
      <div class="mx-auto flex max-w-6xl items-center justify-between px-6 py-4">
        <a href="/site/index.html" class="flex items-center gap-3">
          <span class="flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-amber-500 to-amber-600 text-slate-950 font-bold">TM</span>
          <span class="font-semibold tracking-tight">Tax Monitor Pro</span>
        </a>

        <nav class="hidden items-center gap-8 md:flex">
          <a href="/site/index.html" class="text-sm text-slate-300 hover:text-white transition">Home</a>
          <a href="/site/pricing.html" class="text-sm text-slate-300 hover:text-white transition">Pricing</a>
        </nav>

        <div class="flex items-center gap-3">
          <a
            href="/app/index.html"
            class="hidden md:inline-flex items-center gap-2 rounded-lg border border-slate-700/60 bg-slate-900/40 px-4 py-2 text-sm font-semibold text-slate-100 hover:bg-slate-900/70 transition"
          >Status</a>

          <a
            href="/app/intake.html"
            class="inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-amber-500 to-amber-600 px-4 py-2 text-sm font-semibold text-slate-950 hover:from-amber-400 hover:to-amber-500 transition"
          >Start intake →</a>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <section class="px-6 py-12 md:py-16">
        <div class="mx-auto max-w-3xl">

          <!-- Steps / Progress -->
          <div class="rounded-2xl border border-slate-800/60 bg-slate-900/30 p-6 md:p-8 mb-8">
            <div class="mb-5">
              <div class="text-xs text-slate-500 mb-2">Progress</div>
              <div class="h-2 rounded-full bg-slate-800/70 border border-slate-700/50 overflow-hidden">
                <div class="tm-progress-fill h-full bg-gradient-to-r from-amber-500 to-amber-600" style="width:25%;"></div>
              </div>
            </div>

            <div class="grid grid-cols-4 gap-2 md:gap-4">
              <div class="tm-step tm-step--active flex flex-col items-center text-center">
                <div class="tm-step-num flex h-9 w-9 items-center justify-center rounded-full border border-slate-700/70 bg-slate-950/30 text-sm font-bold">1</div>
                <div class="tm-step-label mt-2 text-xs md:text-sm text-slate-300">Intake</div>
              </div>

              <div class="tm-step flex flex-col items-center text-center">
                <div class="tm-step-num flex h-9 w-9 items-center justify-center rounded-full border border-slate-700/70 bg-slate-950/30 text-sm font-bold text-slate-300">2</div>
                <div class="tm-step-label mt-2 text-xs md:text-sm text-slate-400">Offer</div>
              </div>

              <div class="tm-step flex flex-col items-center text-center">
                <div class="tm-step-num flex h-9 w-9 items-center justify-center rounded-full border border-slate-700/70 bg-slate-950/30 text-sm font-bold text-slate-300">3</div>
                <div class="tm-step-label mt-2 text-xs md:text-sm text-slate-400">Agreement</div>
              </div>

              <div class="tm-step flex flex-col items-center text-center">
                <div class="tm-step-num flex h-9 w-9 items-center justify-center rounded-full border border-slate-700/70 bg-slate-950/30 text-sm font-bold text-slate-300">4</div>
                <div class="tm-step-label mt-2 text-xs md:text-sm text-slate-400">Payment</div>
              </div>
            </div>

            <div class="mt-6 border-t border-slate-800/60 pt-6 text-center">
              <h1 class="text-3xl md:text-5xl font-bold tracking-tight mb-3">
                Intake for <span class="gradient-text">Tax Monitoring</span>
              </h1>
              <p class="text-slate-400 text-lg">
                Submit the basics so we can confirm fit and start monitoring.
              </p>
            </div>
          </div>

          <div class="rounded-2xl border border-slate-800/60 bg-slate-900/30 p-6 md:p-8">
            <form id="tm-intake" method="post" action="/forms/intake" accept-charset="UTF-8" class="space-y-8">
              <!-- Idempotency + validation helpers -->
              <input id="tm_event_id" name="eventId" type="hidden" value="">
              <input id="tm_session_token" name="sessionToken" type="hidden" value="">

              <!-- Identity -->
              <div class="grid gap-4 md:grid-cols-2">
                <div>
                  <label for="crm_first_name" class="block text-sm font-semibold text-slate-200 mb-2">First name</label>
                  <input
                    id="crm_first_name"
                    name="CRM First Name"
                    autocomplete="given-name"
                    class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                    placeholder="First name"
                    required
                    type="text"
                  >
                </div>

                <div>
                  <label for="crm_last_name" class="block text-sm font-semibold text-slate-200 mb-2">Last name</label>
                  <input
                    id="crm_last_name"
                    name="CRM Last Name"
                    autocomplete="family-name"
                    class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                    placeholder="Last name"
                    required
                    type="text"
                  >
                </div>

                <div class="md:col-span-2">
                  <label for="crm_primary_email" class="block text-sm font-semibold text-slate-200 mb-2">Primary email</label>
                  <input
                    id="crm_primary_email"
                    name="CRM Primary Email"
                    autocomplete="email"
                    inputmode="email"
                    class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                    placeholder="you@company.com"
                    required
                    type="email"
                  >
                </div>

                <div class="md:col-span-2">
                  <label for="crm_company_name" class="block text-sm font-semibold text-slate-200 mb-2">Company name (optional)</label>
                  <input
                    id="crm_company_name"
                    name="CRM Company Name"
                    autocomplete="organization"
                    class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                    placeholder="Company / firm / household"
                    type="text"
                  >
                </div>
              </div>

              <!-- Situation -->
              <div class="grid gap-4 md:grid-cols-2">
                <div>
                  <label for="estimated_balance_due_range" class="block text-sm font-semibold text-slate-200 mb-2">Estimated balance due range</label>
                  <select
                    id="estimated_balance_due_range"
                    name="Estimated Balance Due Range"
                    class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                    required
                  >
                    <option value="" disabled selected>Select one</option>
                    <option value="$10,000–$25,000">$10,000–$25,000</option>
                    <option value="$25,001–$50,000">$25,001–$50,000</option>
                    <option value="$50,001–$100,000">$50,001–$100,000</option>
                    <option value="Over $100,000">Over $100,000</option>
                    <option value="Under $10,000">Under $10,000</option>
                    <option value="Unknown">Unknown</option>
                  </select>
                </div>

                <div>
                  <label for="urgency_level" class="block text-sm font-semibold text-slate-200 mb-2">Urgency level</label>
                  <select
                    id="urgency_level"
                    name="Urgency Level"
                    class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                    required
                  >
                    <option value="" disabled selected>Select one</option>
                    <option value="High">High</option>
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="Unsure">Unsure</option>
                  </select>
                </div>

                <div>
                  <label for="irs_notice_received" class="block text-sm font-semibold text-slate-200 mb-2">IRS notice received?</label>
                  <select
                    id="irs_notice_received"
                    name="IRS Notice Received"
                    class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                    required
                  >
                    <option value="" disabled selected>Select one</option>
                    <option value="No">No</option>
                    <option value="Unsure">Unsure</option>
                    <option value="Yes">Yes</option>
                  </select>
                </div>

                <div>
                  <label for="irs_notice_type" class="block text-sm font-semibold text-slate-200 mb-2">IRS notice type</label>
                  <select
                    id="irs_notice_type"
                    name="IRS Notice Type"
                    class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                  >
                    <option value="" selected>Optional</option>
                    <option value="Computer Paragraph (CP) Notice">Computer Paragraph (CP) Notice</option>
                    <option value="IRS Letter (Other)">IRS Letter (Other)</option>
                    <option value="Long Term (LT) Notice">Long Term (LT) Notice</option>
                    <option value="Notice Type Unknown">Notice Type Unknown</option>
                  </select>
                </div>

                <div class="md:col-span-2">
                  <label for="irs_notice_date" class="block text-sm font-semibold text-slate-200 mb-2">IRS notice date (optional)</label>
                  <input
                    id="irs_notice_date"
                    name="IRS Notice Date"
                    class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                    type="text"
                    placeholder="YYYY-MM-DD"
                  >
                  <p class="mt-2 text-xs text-slate-500">If you don’t know the exact date, leave blank.</p>
                </div>

                <div class="md:col-span-2">
                  <label class="block text-sm font-semibold text-slate-200 mb-2">Primary concern</label>

                  <input id="primary_concern_value" name="Primary Concern" type="hidden" value="">

                  <div class="grid gap-3 sm:grid-cols-2">
                    <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-slate-950/25 p-4">
                      <input class="mt-1 tm-concern" type="checkbox" value="IRS Notices">
                      <span>
                        <span class="block font-semibold text-slate-200">IRS Notices</span>
                        <span class="block text-sm text-slate-500">You received letters or notices and want stability.</span>
                      </span>
                    </label>

                    <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-slate-950/25 p-4">
                      <input class="mt-1 tm-concern" type="checkbox" value="Monitoring Account Changes">
                      <span>
                        <span class="block font-semibold text-slate-200">Monitoring Account Changes</span>
                        <span class="block text-sm text-slate-500">You want eyes on transcripts for new activity.</span>
                      </span>
                    </label>

                    <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-slate-950/25 p-4">
                      <input class="mt-1 tm-concern" type="checkbox" value="Preventing Escalation">
                      <span>
                        <span class="block font-semibold text-slate-200">Preventing Escalation</span>
                        <span class="block text-sm text-slate-500">You want early warning before things get worse.</span>
                      </span>
                    </label>

                    <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-slate-950/25 p-4">
                      <input class="mt-1 tm-concern" type="checkbox" value="Unsure / General Concern">
                      <span>
                        <span class="block font-semibold text-slate-200">Unsure / General Concern</span>
                        <span class="block text-sm text-slate-500">You’re not sure yet; you want a baseline view.</span>
                      </span>
                    </label>
                  </div>

                  <p class="mt-2 text-xs text-slate-500">Select all that apply.</p>
                </div>

                <div class="md:col-span-2">
                  <label for="unfiled_returns_indicator" class="block text-sm font-semibold text-slate-200 mb-2">Unfiled returns indicator</label>
                  <select
                    id="unfiled_returns_indicator"
                    name="Unfiled Returns Indicator"
                    class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                    required
                  >
                    <option value="" disabled selected>Select one</option>
                    <option value="No">No</option>
                    <option value="Unsure">Unsure</option>
                    <option value="Yes">Yes</option>
                  </select>
                  <p class="mt-2 text-xs text-slate-500">This is used only to route monitoring recommendations.</p>
                </div>
              </div>

              <!-- Acknowledgement -->
              <div class="rounded-2xl border border-slate-800/60 bg-slate-950/25 p-5">
                <label class="flex items-start gap-3">
                  <input id="monitoring_ack" type="checkbox" class="mt-1" required>
                  <span>
                    <span class="block font-semibold text-slate-200">Monitoring-only acknowledgement</span>
                    <span class="block text-sm text-slate-500">I understand monitoring does not create IRS representation. Representation, filing, and resolution are separate engagements.</span>
                  </span>
                </label>

                <input id="monitoring_ack_value" name="IRS Monitoring Only Acknowledged" type="hidden" value="No">
              </div>

              <!-- Submit -->
              <div class="grid gap-3 md:grid-cols-2">
                <button
                  type="submit"
                  class="inline-flex w-full items-center justify-center rounded-xl bg-gradient-to-r from-amber-500 to-amber-600 px-4 py-3 text-sm font-semibold text-slate-950 hover:from-amber-400 hover:to-amber-500 transition"
                >Submit intake →</button>

                <a
                  href="/site/pricing.html"
                  class="inline-flex w-full items-center justify-center rounded-xl border border-slate-700/70 bg-slate-950/20 px-4 py-3 text-sm font-semibold text-slate-100 hover:bg-slate-950/35 transition"
                >View pricing</a>
              </div>

              <div class="text-xs text-slate-500">
                After submission, route to <code class="text-slate-300">/app/intake-confirmation.html</code> from your Worker response or client-side redirect.
              </div>
            </form>
          </div>

          <div class="mt-8 text-center text-sm text-slate-500">
            Monitoring does not create IRS representation. Representation, filing, and resolution are separate engagements.
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="border-t border-slate-800/60 bg-slate-950/70">
      <div class="mx-auto max-w-6xl px-6 py-10">
        <div class="flex flex-col gap-3 text-xs text-slate-500 md:flex-row md:items-center md:justify-between">
          <div>© <span id="footer-year"></span> Tax Monitor Pro. All rights reserved.</div>
          <div class="flex gap-4">
            <a class="hover:text-slate-300 transition" href="/legal/privacy.html">Privacy</a>
            <a class="hover:text-slate-300 transition" href="/legal/terms.html">Terms</a>
          </div>
        </div>
      </div>
    </footer>

  </div>

  <script>
    (function () {
      var y = document.getElementById('footer-year');
      if (y) y.textContent = String(new Date().getFullYear());
    })();
  </script>

  <script>
    (function () {
      var ack = document.getElementById('monitoring_ack');
      var ackValue = document.getElementById('monitoring_ack_value');
      var concerns = Array.prototype.slice.call(document.querySelectorAll('.tm-concern'));
      var concernsValue = document.getElementById('primary_concern_value');
      var form = document.getElementById('tm-intake');

      function syncAck() {
        if (!ackValue) return;
        ackValue.value = ack && ack.checked ? 'Yes' : 'No';
      }

      function syncConcerns() {
        if (!concernsValue) return;
        var picked = [];
        for (var i = 0; i < concerns.length; i++) {
          if (concerns[i].checked) picked.push(String(concerns[i].value || '').trim());
        }
        concernsValue.value = picked.filter(Boolean).join(',');
      }

      function ensureEventId() {
        var el = document.getElementById('tm_event_id');
        if (!el) return;

        var key = 'tm:intake:eventId';
        var existing = sessionStorage.getItem(key);
        if (!existing) {
          existing = (crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now());
          sessionStorage.setItem(key, existing);
        }
        el.value = existing;
      }

      function syncSessionToken() {
        var el = document.getElementById('tm_session_token');
        if (!el) return;

        // Placeholder: pull from URL (?token=...) or existing localStorage key, whichever you decide later.
        var params = new URLSearchParams(window.location.search || '');
        var t = params.get('token') || params.get('sessionToken') || '';
        el.value = t;
      }

      if (ack) ack.addEventListener('change', syncAck);
      for (var i = 0; i < concerns.length; i++) concerns[i].addEventListener('change', syncConcerns);

      if (form) {
        form.addEventListener('submit', function () {
          ensureEventId();
          syncSessionToken();
          syncAck();
          syncConcerns();
        });
      }

      ensureEventId();
      syncSessionToken();
      syncAck();
      syncConcerns();
    })();
  </script>

  <!-- Flatpickr -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    (function () {
      var el = document.getElementById('irs_notice_date');
      if (!el || !window.flatpickr) return;

      window.flatpickr(el, {
        allowInput: true,
        dateFormat: "Y-m-d"
      });
    })();
  </script>
</body>
</html>

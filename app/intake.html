<!--/app/intake.html-->
<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tax Monitor Pro — Intake</title>

  <!-- Match offer.html Tailwind pin -->
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet">

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/assets/favicon.ico" sizes="any">
  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
  <link rel="apple-touch-icon" href="/assets/favicon.ico">

  <!-- Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <style>
    body { box-sizing: border-box; }
    * { font-family: 'DM Sans', sans-serif; }

    /* Noise texture overlay (match offer.html) */
    .noise-bg {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.06;
      background-image:
        radial-gradient(circle at 1px 1px, rgba(255,255,255,0.06) 1px, transparent 0);
      background-size: 3px 3px;
      z-index: 0;
    }

    /* Aurora background */
    .aurora {
      position: fixed;
      inset: 0;
      overflow: hidden;
      z-index: 0;
      pointer-events: none;
    }
    .aurora-blob {
      position: absolute;
      border-radius: 9999px;
      filter: blur(80px);
      opacity: 0.45;
      animation: float 18s ease-in-out infinite;
    }
    .aurora-blob-1 {
      width: 520px;
      height: 520px;
      background: radial-gradient(circle, rgba(245,158,11,0.95) 0%, transparent 70%);
      top: -210px;
      right: -140px;
    }
    .aurora-blob-2 {
      width: 520px;
      height: 520px;
      background: radial-gradient(circle, rgba(239,68,68,0.7) 0%, transparent 70%);
      bottom: -220px;
      left: -150px;
      animation-delay: 2s;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px) translateX(0px); }
      50% { transform: translateY(-18px) translateX(10px); }
    }

    /* Glass card surface */
    .glass-card {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.10);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-radius: 16px; /* match offer.html */
    }

    /* Progress + glow helpers (offer.html parity) */
    .progress-glow {
      background: linear-gradient(90deg, #f59e0b, #d97706);
      box-shadow: 0 0 20px rgba(245,158,11,0.45);
    }
    .glow-divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(245,158,11,0.35), transparent);
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(245,158,11,0.30); }
      50% { box-shadow: 0 0 40px rgba(245,158,11,0.50); }
    }
    .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }

    /* Animated gradient text (marketing polish) */
    .gradient-text {
      background: linear-gradient(135deg, #f59e0b, #ef4444, #f59e0b, #fbbf24);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: gradientShift 4s ease infinite;
    }
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    /* Gradient border wrapper (subtle) */
    .gradient-border { position: relative; }
    .gradient-border::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: inherit;
      padding: 2px;
      background: linear-gradient(135deg, rgba(245,158,11,0.9), rgba(239,68,68,0.7), rgba(251,191,36,0.9));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.55;
      pointer-events: none;
    }

    /* Smooth load-in */
    .fade-in-up { opacity: 0; transform: translateY(10px); animation: fadeInUp 600ms ease forwards; }
    .delay-1 { animation-delay: 80ms; }
    .delay-2 { animation-delay: 160ms; }
    .delay-3 { animation-delay: 240ms; }
    @keyframes fadeInUp {
      to { opacity: 1; transform: translateY(0); }
    }

    /* Custom scrollbars for WebKit */
    ::-webkit-scrollbar { width: 10px; height: 10px; }
    ::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.25); border-radius: 9999px; }
    ::-webkit-scrollbar-track { background: rgba(2, 6, 23, 0.35); }
  </style>
</head>

<body class="h-full bg-slate-950 text-slate-100">
  <div class="min-h-full flex flex-col">
  <div class="aurora">
    <div class="aurora-blob aurora-blob-1"></div>
    <div class="aurora-blob aurora-blob-2"></div>
  </div>
  <div class="noise-bg"></div>

  <!-- Sticky Header + Flow Stepper (Intake → Offer → Agreement → Payment) -->
  <header class="sticky top-0 z-50 glass-card border-b border-slate-800/60">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-4">
      <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
        <!-- Brand -->
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center">
            <span class="font-black text-slate-950">TM</span>
          </div>
          <div>
            <div class="font-bold text-slate-100">Tax Monitor Pro</div>
            <div class="text-xs text-slate-400">Intake</div>
          </div>
        </div>

        <!-- Stepper -->
        <div class="flex items-center gap-2 sm:gap-4">
          <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-amber-500 flex items-center justify-center animate-pulse-glow">
              <span class="text-xs font-bold text-slate-950">1</span>
            </div>
            <span class="text-sm font-semibold text-amber-400">Intake</span>
          </div>

          <div class="w-8 h-0.5 bg-slate-700"></div>

          <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center">
              <span class="text-xs text-slate-400">2</span>
            </div>
            <span class="text-sm text-slate-500 hidden sm:inline">Offer</span>
          </div>

          <div class="w-8 h-0.5 bg-slate-700"></div>

          <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center">
              <span class="text-xs text-slate-400">3</span>
            </div>
            <span class="text-sm text-slate-500 hidden sm:inline">Agreement</span>
          </div>

          <div class="w-8 h-0.5 bg-slate-700"></div>

          <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center">
              <span class="text-xs text-slate-400">4</span>
            </div>
            <span class="text-sm text-slate-500 hidden sm:inline">Payment</span>
          </div>
        </div>

        <!-- Back -->
        <a
          href="/site/index.html"
          class="inline-flex items-center gap-2 rounded-full border border-slate-800/70 bg-black/20 px-3 py-1.5 text-xs font-semibold text-slate-300 hover:text-amber-300 hover:border-amber-500/30"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          Back
        </a>
      </div>

      <!-- Progress bar -->
      <div class="mt-4 h-1 bg-slate-900/60 rounded-full overflow-hidden">
        <div class="h-full w-1/4 progress-glow rounded-full"></div>
      </div>
    </div>
  </header>

<main class="flex-1 max-w-2xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
    <div class="relative z-10">
      <!-- Title / Hero (match offer.html title block styling) -->
      <div class="glass-card p-8 text-center fade-in-up delay-1 mb-10">
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-amber-500/10 border border-amber-500/20 mb-6">
          <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span class="text-amber-400 font-medium text-sm">Monitoring Profile Initiated</span>
        </div>
        <h1 class="text-3xl md:text-4xl font-bold mb-4 bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent">
          Your Tax Monitoring Intake
        </h1>
        <p class="text-slate-400 text-lg max-w-2xl mx-auto mb-6">Visibility first. Decisions second.</p>
        <div class="h-px w-full glow-divider"></div>
        <div class="mt-6 text-sm text-slate-500">Fill out the form below to generate your monitoring offer.</div>
      </div>

      <!-- Form Card (match offer.html surface) -->
      <section class="glass-card gradient-border rounded-3xl p-6 sm:p-8 fade-in-up delay-2">
        <form
          id="tm-intake"
          data-tm-form
          method="post"
          action="https://api.taxmonitor.pro/forms/intake"
          accept-charset="UTF-8"
          class="space-y-8"
        >
          <!-- Idempotency + validation helpers -->
          <input id="tm_event_id" name="eventId" type="hidden" value="">
          <input id="tm_session_token" name="sessionToken" type="hidden" value="">

          <!-- Identity -->
          <div class="flex items-center justify-between gap-4">
            <div>
              <h2 class="text-lg font-semibold text-slate-100">Your information</h2>
              <p class="mt-1 text-sm text-slate-500">Enough to identify you and deliver your monitoring report.</p>
            </div>
            
          </div>

          <div class="grid gap-4 md:grid-cols-2">
            <div>
              <label for="crm_first_name" class="block text-sm font-semibold text-slate-200 mb-2">First name</label>
              <input
                id="crm_first_name"
                name="CRM First Name"
                autocomplete="given-name"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                placeholder="First name"
                required
                type="text"
              >
            </div>

            <div>
              <label for="crm_last_name" class="block text-sm font-semibold text-slate-200 mb-2">Last name</label>
              <input
                id="crm_last_name"
                name="CRM Last Name"
                autocomplete="family-name"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                placeholder="Last name"
                required
                type="text"
              >
            </div>

            <div class="md:col-span-2">
              <label for="crm_primary_email" class="block text-sm font-semibold text-slate-200 mb-2">Primary email</label>
              <input
                id="crm_primary_email"
                name="CRM Primary Email"
                autocomplete="email"
                inputmode="email"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                placeholder="you@company.com"
                required
                type="email"
              >
            </div>

            <div class="md:col-span-2">
              <label for="crm_company_name" class="block text-sm font-semibold text-slate-200 mb-2">Company name (optional)</label>
              <input
                id="crm_company_name"
                name="CRM Company Name"
                autocomplete="organization"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                placeholder="Company"
                type="text"
              >
            </div>

            <div class="pt-2 border-t border-slate-800/60"></div>

            <div class="flex items-start justify-between gap-4 md:col-span-2">
              <div>
                <h2 class="text-lg font-semibold text-slate-100">Tax snapshot</h2>
                <p class="mt-1 text-sm text-slate-500">Tell us what you know. Leave anything blank if you are unsure.</p>
              </div>
            </div>

            <div>
              <label for="urgency_level" class="block text-sm font-semibold text-slate-200 mb-2">Urgency level</label>
              <select
                id="urgency_level"
                name="Urgency Level"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                required
              >
                <option value="">Select one</option>
                <option value="1 — Low">1 — Low</option>
                <option value="2 — Medium">2 — Medium</option>
                <option value="3 — High">3 — High</option>
                <option value="4 — Critical">4 — Critical</option>
              </select>
              <p class="mt-2 text-xs text-slate-500">How quickly you need clarity and a plan.</p>
            </div>

            <div>
              <label for="irs_notice_received" class="block text-sm font-semibold text-slate-200 mb-2">IRS notice received?</label>
              <select
                id="irs_notice_received"
                name="IRS Notice Received"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                required
              >
                <option value="">Select one</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
                <option value="Not Sure">Not Sure</option>
              </select>
              <p class="mt-2 text-xs text-slate-500">Any letters, notices, or collections correspondence.</p>
            </div>

            <div>
              <label for="irs_notice_type" class="block text-sm font-semibold text-slate-200 mb-2">IRS notice type (optional)</label>
              <select
                id="irs_notice_type"
                name="IRS Notice Type"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
              >
                <option value="">Select one</option>
                <option value="CP">CP</option>
                <option value="LT">LT</option>
                <option value="Letter">Letter</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div>
              <label for="irs_notice_date" class="block text-sm font-semibold text-slate-200 mb-2">IRS notice date (optional)</label>
              <input
                id="irs_notice_date"
                name="IRS Notice Date"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                placeholder="YYYY-MM-DD"
                type="text"
              >
              <p class="mt-2 text-xs text-slate-500">If you don’t know the exact date, leave blank.</p>
            </div>

            <div class="md:col-span-2">
              <label class="block text-sm font-semibold text-slate-200 mb-2">Primary concern</label>

              <input id="primary_concern_value" name="Primary Concern" type="hidden" value="">

              <div class="grid gap-3 sm:grid-cols-2">
                <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-black/20 p-4">
                  <input class="mt-1 tm-concern" type="checkbox" value="IRS Notices">
                  <span>
                    <span class="block font-semibold text-slate-200">IRS Notices</span>
                    <span class="block text-sm text-slate-500">You received letters and want clarity.</span>
                  </span>
                </label>

                <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-black/20 p-4">
                  <input class="mt-1 tm-concern" type="checkbox" value="Unfiled Returns">
                  <span>
                    <span class="block font-semibold text-slate-200">Unfiled Returns</span>
                    <span class="block text-sm text-slate-500">You might have missing returns.</span>
                  </span>
                </label>

                <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-black/20 p-4">
                  <input class="mt-1 tm-concern" type="checkbox" value="Balance Due">
                  <span>
                    <span class="block font-semibold text-slate-200">Balance Due</span>
                    <span class="block text-sm text-slate-500">You suspect you owe taxes.</span>
                  </span>
                </label>

                <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-black/20 p-4">
                  <input class="mt-1 tm-concern" type="checkbox" value="Transcript Monitoring">
                  <span>
                    <span class="block font-semibold text-slate-200">Transcript Monitoring</span>
                    <span class="block text-sm text-slate-500">You want proactive account visibility.</span>
                  </span>
                </label>
              </div>
              <p class="mt-2 text-xs text-slate-500">Select one. We’ll tailor the next steps to this.</p>
            </div>

            <div>
              <label for="unfiled_returns_indicator" class="block text-sm font-semibold text-slate-200 mb-2">Unfiled returns indicator</label>
              <select
                id="unfiled_returns_indicator"
                name="Unfiled Returns Indicator"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                required
              >
                <option value="">Select one</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
                <option value="Not Sure">Not Sure</option>
              </select>
            </div>

            <div>
              <label for="estimated_balance_due_range" class="block text-sm font-semibold text-slate-200 mb-2">Estimated balance due range</label>
              <select
                id="estimated_balance_due_range"
                name="Estimated Balance Due Range"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                required
              >
                <option value="">Select one</option>
                <option value="$0">$0</option>
                <option value="$1–$5,000">$1–$5,000</option>
                <option value="$5,001–$10,000">$5,001–$10,000</option>
                <option value="$10,001–$25,000">$10,001–$25,000</option>
                <option value="$25,001–$50,000">$25,001–$50,000</option>
                <option value="$50,001–$100,000">$50,001–$100,000</option>
                <option value="$100,000+">$100,000+</option>
                <option value="Not Sure">Not Sure</option>
              </select>
            </div>

            <div class="pt-2 border-t border-slate-800/60"></div>

            <div class="flex items-start justify-between gap-4 md:col-span-2">
              <div>
                <h2 class="text-lg font-semibold text-slate-100">Agreement & consent</h2>
                <p class="mt-1 text-sm text-slate-500">We monitor and report. We do not represent you before the IRS.</p>
              </div>
            </div>

            <div class="md:col-span-2">
              <label class="flex items-start gap-3 rounded-2xl border border-slate-800/60 bg-black/20 p-4">
                <input
                  id="irs_monitoring_only_ack"
                  name="IRS Monitoring Only Acknowledged"
                  type="checkbox"
                  class="mt-1"
                  value="true"
                  required
                >
                <span>
                  <span class="block font-semibold text-slate-200">I understand this service is monitoring-only</span>
                  <span class="block text-sm text-slate-500">Monitoring does not create IRS representation. If representation is needed, we’ll handle that separately.</span>
                </span>
              </label>
            </div>
          </div>

          <!-- Submit -->
          <div class="grid gap-3 sm:grid-cols-2">
            <a
              href="/app/index.html"
              class="inline-flex w-full items-center justify-center rounded-2xl border border-slate-800/70 bg-black/20 px-6 py-3 font-semibold text-slate-200 hover:bg-black/30"
            >
              Back
            </a>
            <button
              type="submit"
              class="inline-flex w-full items-center justify-center rounded-2xl bg-amber-500 px-6 py-3 font-semibold text-slate-950 shadow-lg shadow-amber-500/20 hover:bg-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
              data-tm-submit
            >
              Continue
            </button>
          </div>

          <!-- Error display -->
          <div id="tm_error" class="hidden rounded-2xl border border-red-500/30 bg-red-500/10 p-4 text-sm text-red-200"></div>
        </form>
      </section>
    </div>
  </main>

  <!-- Footer (match offer.html) -->
  <footer class="glass-card mx-4 mb-4 px-6 py-4">
    <div class="max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
      <p class="text-slate-500 text-sm">© <span id="footer-year"></span> Tax Monitor Pro. All rights reserved.</p>
      <div class="flex items-center gap-6">
        <a href="/legal/privacy.html" class="text-slate-400 hover:text-amber-400 text-sm transition-colors">Privacy Policy</a>
        <a href="/legal/terms.html" class="text-slate-400 hover:text-amber-400 text-sm transition-colors">Terms of Service</a>
        <a href="/site/contact.html" class="text-slate-400 hover:text-amber-400 text-sm transition-colors">Contact Support</a>
      </div>
    </div>
  </footer>

  <script>
    (function () {
      var y = document.getElementById('footer-year');
      if (y) y.textContent = String(new Date().getFullYear());
    })();
  </script>

  <!-- Shared helpers (offer.html parity) -->
  <script>
    (function () {
      // Minimal shared helpers with safe fallbacks
      window.tmCommon = window.tmCommon || {
        ensureEventId: function (form) {
          var el = document.getElementById('tm_event_id');
          if (!el) return;
          if (el.value) return;
          var id = (window.crypto && crypto.randomUUID) ? crypto.randomUUID() : (Date.now() + '-' + Math.random().toString(16).slice(2));
          el.value = id;
        },
        syncSessionToken: function () {
          var qs = new URLSearchParams(window.location.search || '');
          var token = qs.get('sessionToken') || '';
          var el = document.getElementById('tm_session_token');
          if (el) el.value = token;
        },
        disableSubmit: function (form) {
          var btn = form.querySelector('[data-tm-submit]');
          if (!btn) return;
          btn.disabled = true;
          btn.dataset.tmLabel = btn.textContent;
          btn.textContent = 'Submitting…';
          btn.classList.add('opacity-80', 'cursor-not-allowed');
        },
        restoreSubmit: function (form) {
          var btn = form.querySelector('[data-tm-submit]');
          if (!btn) return;
          btn.disabled = false;
          if (btn.dataset.tmLabel) btn.textContent = btn.dataset.tmLabel;
          btn.classList.remove('opacity-80', 'cursor-not-allowed');
        },
        showError: function (msg) {
          var el = document.getElementById('tm_error');
          if (!el) return;
          el.textContent = msg || 'Something went wrong.';
          el.classList.remove('hidden');
        }
      };

      var form = document.getElementById('tm-intake');
      var ack = document.getElementById('irs_monitoring_only_ack');
      var concerns = document.querySelectorAll('.tm-concern');

      function syncAck() {
        if (!ack) return;
        ack.value = ack.checked ? 'true' : 'false';
      }

      function syncConcerns() {
        var out = document.getElementById('primary_concern_value');
        if (!out) return;
        var picked = [];
        for (var i = 0; i < concerns.length; i++) {
          if (concerns[i].checked) picked.push(concerns[i].value);
        }
        // Single-select feel: keep first if multiple
        if (picked.length > 1) {
          for (var j = 1; j < concerns.length; j++) concerns[j].checked = false;
          picked = picked.slice(0, 1);
        }
        out.value = picked.map(Boolean).join(',');
      }

      if (ack) ack.addEventListener('change', syncAck);
      for (var i = 0; i < concerns.length; i++) concerns[i].addEventListener('change', syncConcerns);

      if (form) {
        form.addEventListener('submit', async function (e) {
          e.preventDefault();

          if (window.tmCommon) {
            window.tmCommon.ensureEventId(form);
            window.tmCommon.syncSessionToken();
          }

          syncAck();
          syncConcerns();

          if (window.tmCommon) window.tmCommon.disableSubmit(form);

          try {
            var res = await fetch(form.action, { method: 'POST', body: new FormData(form) });
            var data = {};
            try { data = await res.json(); } catch (err) {}

            if (res.ok && data && data.ok) {
              window.location.href = '/app/offer.html' + (window.location.search || '');
              return;
            }

            var msg = (data && (data.error || data.details)) ? (data.error || data.details) : 'Submission failed.';
            if (window.tmCommon) window.tmCommon.showError(msg);
            if (window.tmCommon) window.tmCommon.restoreSubmit(form);
          } catch (err) {
            if (window.tmCommon) window.tmCommon.showError(String(err && err.message ? err.message : err));
            if (window.tmCommon) window.tmCommon.restoreSubmit(form);
          }
        });
      }

      if (window.tmCommon) {
        window.tmCommon.ensureEventId(form);
        window.tmCommon.syncSessionToken();
      }
      syncAck();
      syncConcerns();
    })();
  </script>

  <!-- Flatpickr -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    (function () {
      var el = document.getElementById('irs_notice_date');
      if (!el || !window.flatpickr) return;

      window.flatpickr(el, {
        allowInput: true,
        dateFormat: "Y-m-d"
      });
    })();
  </script>
  </div>
</body>
</html>
<!--/app/intake.html-->
<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tax Monitor Pro — Intake</title>

  <!-- Match offer.html Tailwind pin -->
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet">

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/assets/favicon.ico" sizes="any">
  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
  <link rel="apple-touch-icon" href="/assets/favicon.ico">

  <!-- Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <style>
    body { box-sizing: border-box; }
    * { font-family: 'DM Sans', sans-serif; }

    /* Noise texture overlay (match offer.html) */
    .noise-bg::before{
      content:'';
      position:fixed; inset:0;
      opacity:.03;
      background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      pointer-events:none;
      z-index:1;
    }

    /* Aurora blobs (match offer.html) */
    .aurora-blob{ position:absolute; border-radius:50%; filter:blur(100px); opacity:.14; animation:float 20s ease-in-out infinite; }
    .aurora-1{ width:650px; height:420px; background:linear-gradient(135deg,#F59E0B,#D97706); top:8%; right:-12%; }
    .aurora-2{ width:520px; height:360px; background:linear-gradient(135deg,#2DD4BF,#14B8A6); top:42%; left:-16%; opacity:.08; animation-delay:-7s; }
    .aurora-3{ width:480px; height:320px; background:linear-gradient(135deg,#F59E0B,#EA580C); bottom:4%; right:18%; animation-delay:-14s; }
    @keyframes float{ 0%,100%{transform:translate(0,0) scale(1)} 33%{transform:translate(30px,-30px) scale(1.05)} 66%{transform:translate(-20px,20px) scale(.95)} }

    /* Glass (match offer.html) */
    .glass-card{ background:rgba(15,23,42,.62); backdrop-filter:blur(20px); border:1px solid rgba(148,163,184,.12); }
    .glass-card-light{ background:rgba(30,41,59,.50); backdrop-filter:blur(16px); border:1px solid rgba(148,163,184,.16); }

    /* Glow (match offer.html) */
    .glow-amber{ box-shadow:0 0 40px rgba(245,158,11,.26), 0 0 80px rgba(245,158,11,.10); }
    .glow-amber-soft{ box-shadow:0 0 30px rgba(245,158,11,.18); }
    .progress-glow{ background:linear-gradient(90deg,#F59E0B,#D97706); box-shadow:0 0 20px rgba(245,158,11,.5); }
    .glow-divider{ height:1px; background:linear-gradient(90deg,transparent,rgba(245,158,11,.5),transparent); }

    @keyframes pulse-glow{ 0%,100%{box-shadow:0 0 20px rgba(245,158,11,.30)} 50%{box-shadow:0 0 40px rgba(245,158,11,.50)} }
    .animate-pulse-glow{ animation:pulse-glow 2s ease-in-out infinite; }

    /* Scrollbar (match offer.html) */
    ::-webkit-scrollbar{ width:8px; }
    ::-webkit-scrollbar-track{ background:#0B1220; }
    ::-webkit-scrollbar-thumb{ background:#1E293B; border-radius:4px; }
    ::-webkit-scrollbar-thumb:hover{ background:#334155; }
  </style>

  <style>
    /* Flatpickr theme (dark + amber) */
    .flatpickr-calendar {
      background: rgba(2, 6, 23, 0.98);
      border: 1px solid rgba(148, 163, 184, 0.25);
      border-radius: 16px;
      box-shadow: 0 18px 60px rgba(0, 0, 0, 0.55);
      color: rgba(241, 245, 249, 0.92);
      font-family: 'DM Sans', sans-serif;
    }
    .flatpickr-current-month,
    .flatpickr-weekday { color: rgba(226, 232, 240, 0.9); }
    .flatpickr-day { border-radius: 12px; color: rgba(241, 245, 249, 0.88); }
    .flatpickr-day:hover {
      background: rgba(245, 158, 11, 0.12);
      border-color: rgba(245, 158, 11, 0.25);
    }
    .flatpickr-day.selected,
    .flatpickr-day.startRange,
    .flatpickr-day.endRange {
      background: linear-gradient(135deg, #F59E0B, #D97706);
      border-color: rgba(245, 158, 11, 0.35);
      color: rgba(2, 6, 23, 0.98);
    }
    .flatpickr-months .flatpickr-prev-month,
    .flatpickr-months .flatpickr-next-month { color: rgba(226, 232, 240, 0.8); }
  </style>

  <style>@view-transition { navigation: auto; }</style>
</head>

<body class="h-full bg-[#020617] text-slate-200 noise-bg overflow-auto">
  <!-- Aurora (match offer.html) -->
  <div class="aurora-blob aurora-1"></div>
  <div class="aurora-blob aurora-2"></div>
  <div class="aurora-blob aurora-3"></div>

  <div class="relative z-10 min-h-full w-full">
    <!-- Sticky Header (match offer.html structure) -->
    <header class="sticky top-0 z-50 glass-card border-b border-slate-700/50">
      <div class="max-w-6xl mx-auto px-4 py-4">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
          <!-- Logo -->
          <a href="/site/index.html" class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center">
              <span class="font-black text-slate-950">TM</span>
            </div>
            <span class="font-bold text-lg text-slate-100">Tax Monitor Pro</span>
          </a>

          <!-- Stepper -->
          <div class="flex items-center gap-2 sm:gap-4">
            <div class="flex items-center gap-2">
              <div class="w-7 h-7 rounded-full bg-amber-500 flex items-center justify-center animate-pulse-glow">
                <span class="text-xs font-bold text-slate-900">1</span>
              </div>
              <span class="text-sm font-semibold text-amber-400">Intake</span>
            </div>

            <div class="w-8 h-0.5 bg-slate-600"></div>

            <div class="flex items-center gap-2">
              <div class="w-7 h-7 rounded-full bg-slate-700 border border-slate-600 flex items-center justify-center">
                <span class="text-xs text-slate-400">2</span>
              </div>
              <span class="text-sm text-slate-500 hidden sm:inline">Offer</span>
            </div>

            <div class="w-8 h-0.5 bg-slate-600"></div>

            <div class="flex items-center gap-2">
              <div class="w-7 h-7 rounded-full bg-slate-700 border border-slate-600 flex items-center justify-center">
                <span class="text-xs text-slate-400">3</span>
              </div>
              <span class="text-sm text-slate-500 hidden sm:inline">Agreement</span>
            </div>

            <div class="w-8 h-0.5 bg-slate-600"></div>

            <div class="flex items-center gap-2">
              <div class="w-7 h-7 rounded-full bg-slate-700 border border-slate-600 flex items-center justify-center">
                <span class="text-xs text-slate-400">4</span>
              </div>
              <span class="text-sm text-slate-500 hidden sm:inline">Payment</span>
            </div>
          </div>

          <!-- Validity chip -->
          <div class="hidden lg:flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-800/80 border border-slate-700">
            <svg class="w-4 h-4 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="text-xs text-slate-300">Valid for 7 days</span>
          </div>
        </div>

        <!-- Progress bar (Intake = 25%) -->
        <div class="mt-4 h-1 bg-slate-800 rounded-full overflow-hidden">
          <div class="h-full w-1/4 progress-glow rounded-full"></div>
        </div>
      </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-8 space-y-8">
      <!-- Page Title (match offer.html layout) -->
      <div class="text-center space-y-3">
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent">
          Your Tax Monitoring Intake
        </h1>
        <p class="text-lg sm:text-xl text-slate-400">Visibility first. Decisions second.</p>
      </div>

      <!-- Form Card (match offer.html surface) -->
      <section class="glass-card rounded-3xl p-6 sm:p-8">
        <form
          id="tm-intake"
          data-tm-form
          method="post"
          action="https://api.taxmonitor.pro/forms/intake"
          accept-charset="UTF-8"
          class="space-y-8"
        >
          <!-- Idempotency + validation helpers -->
          <input id="tm_event_id" name="eventId" type="hidden" value="">
          <input id="tm_session_token" name="sessionToken" type="hidden" value="">

          <!-- Identity -->
          <div class="grid gap-4 md:grid-cols-2">
            <div>
              <label for="crm_first_name" class="block text-sm font-semibold text-slate-200 mb-2">First name</label>
              <input
                id="crm_first_name"
                name="CRM First Name"
                autocomplete="given-name"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                placeholder="First name"
                required
                type="text"
              >
            </div>

            <div>
              <label for="crm_last_name" class="block text-sm font-semibold text-slate-200 mb-2">Last name</label>
              <input
                id="crm_last_name"
                name="CRM Last Name"
                autocomplete="family-name"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                placeholder="Last name"
                required
                type="text"
              >
            </div>

            <div class="md:col-span-2">
              <label for="crm_primary_email" class="block text-sm font-semibold text-slate-200 mb-2">Primary email</label>
              <input
                id="crm_primary_email"
                name="CRM Primary Email"
                autocomplete="email"
                inputmode="email"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                placeholder="you@company.com"
                required
                type="email"
              >
            </div>

            <div class="md:col-span-2">
              <label for="crm_company_name" class="block text-sm font-semibold text-slate-200 mb-2">Company name (optional)</label>
              <input
                id="crm_company_name"
                name="CRM Company Name"
                autocomplete="organization"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                placeholder="Company / firm / household"
                type="text"
              >
            </div>
          </div>

          <div class="glow-divider"></div>

          <!-- Situation -->
          <div class="grid gap-4 md:grid-cols-2">
            <div>
              <label for="estimated_balance_due_range" class="block text-sm font-semibold text-slate-200 mb-2">Estimated balance due range</label>
              <select
                id="estimated_balance_due_range"
                name="Estimated Balance Due Range"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                required
              >
                <option value="" disabled selected>Select one</option>
                <option value="$10,000–$25,000">$10,000–$25,000</option>
                <option value="$25,001–$50,000">$25,001–$50,000</option>
                <option value="$50,001–$100,000">$50,001–$100,000</option>
                <option value="Over $100,000">Over $100,000</option>
                <option value="Under $10,000">Under $10,000</option>
                <option value="Unknown">Unknown</option>
              </select>
            </div>

            <div>
              <label for="urgency_level" class="block text-sm font-semibold text-slate-200 mb-2">Urgency level</label>
              <select
                id="urgency_level"
                name="Urgency Level"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                required
              >
                <option value="" disabled selected>Select one</option>
                <option value="High">High</option>
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="Unsure">Unsure</option>
              </select>
            </div>

            <div>
              <label for="irs_notice_received" class="block text-sm font-semibold text-slate-200 mb-2">IRS notice received?</label>
              <select
                id="irs_notice_received"
                name="IRS Notice Received"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                required
              >
                <option value="" disabled selected>Select one</option>
                <option value="No">No</option>
                <option value="Unsure">Unsure</option>
                <option value="Yes">Yes</option>
              </select>
            </div>

            <div>
              <label for="irs_notice_type" class="block text-sm font-semibold text-slate-200 mb-2">IRS notice type</label>
              <select
                id="irs_notice_type"
                name="IRS Notice Type"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
              >
                <option value="" selected>Optional</option>
                <option value="Computer Paragraph (CP) Notice">Computer Paragraph (CP) Notice</option>
                <option value="IRS Letter (Other)">IRS Letter (Other)</option>
                <option value="Long Term (LT) Notice">Long Term (LT) Notice</option>
                <option value="Notice Type Unknown">Notice Type Unknown</option>
              </select>
            </div>

            <div class="md:col-span-2">
              <label for="irs_notice_date" class="block text-sm font-semibold text-slate-200 mb-2">IRS notice date (optional)</label>
              <input
                id="irs_notice_date"
                name="IRS Notice Date"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                type="text"
                placeholder="YYYY-MM-DD"
              >
              <p class="mt-2 text-xs text-slate-500">If you don’t know the exact date, leave blank.</p>
            </div>

            <div class="md:col-span-2">
              <label class="block text-sm font-semibold text-slate-200 mb-2">Primary concern</label>

              <input id="primary_concern_value" name="Primary Concern" type="hidden" value="">

              <div class="grid gap-3 sm:grid-cols-2">
                <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-black/20 p-4">
                  <input class="mt-1 tm-concern" type="checkbox" value="IRS Notices">
                  <span>
                    <span class="block font-semibold text-slate-200">IRS Notices</span>
                    <span class="block text-sm text-slate-500">You received letters or notices and want stability.</span>
                  </span>
                </label>

                <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-black/20 p-4">
                  <input class="mt-1 tm-concern" type="checkbox" value="Monitoring Account Changes">
                  <span>
                    <span class="block font-semibold text-slate-200">Monitoring Account Changes</span>
                    <span class="block text-sm text-slate-500">You want eyes on transcripts for new activity.</span>
                  </span>
                </label>

                <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-black/20 p-4">
                  <input class="mt-1 tm-concern" type="checkbox" value="Preventing Escalation">
                  <span>
                    <span class="block font-semibold text-slate-200">Preventing Escalation</span>
                    <span class="block text-sm text-slate-500">You want early warning before things get worse.</span>
                  </span>
                </label>

                <label class="flex items-start gap-3 rounded-xl border border-slate-800/60 bg-black/20 p-4">
                  <input class="mt-1 tm-concern" type="checkbox" value="Unsure / General Concern">
                  <span>
                    <span class="block font-semibold text-slate-200">Unsure / General Concern</span>
                    <span class="block text-sm text-slate-500">You’re not sure yet; you want a baseline view.</span>
                  </span>
                </label>
              </div>

              <p class="mt-2 text-xs text-slate-500">Select all that apply.</p>
            </div>

            <div class="md:col-span-2">
              <label for="unfiled_returns_indicator" class="block text-sm font-semibold text-slate-200 mb-2">Unfiled returns indicator</label>
              <select
                id="unfiled_returns_indicator"
                name="Unfiled Returns Indicator"
                class="w-full rounded-xl border border-slate-700/70 bg-slate-950/40 px-4 py-3 text-slate-100 focus:outline-none focus:ring-2 focus:ring-amber-500/40"
                required
              >
                <option value="" disabled selected>Select one</option>
                <option value="No">No</option>
                <option value="Unsure">Unsure</option>
                <option value="Yes">Yes</option>
              </select>
              <p class="mt-2 text-xs text-slate-500">This is used only to route monitoring recommendations.</p>
            </div>
          </div>

          <div class="glow-divider"></div>

          <!-- Acknowledgement -->
          <div class="rounded-2xl border border-slate-800/60 bg-black/20 p-5">
            <label class="flex items-start gap-3">
              <input id="monitoring_ack" type="checkbox" class="mt-1" required>
              <span>
                <span class="block font-semibold text-slate-200">Monitoring-only acknowledgement</span>
                <span class="block text-sm text-slate-500">I understand monitoring does not create IRS representation. Representation, filing, and resolution are separate engagements.</span>
              </span>
            </label>

            <input id="monitoring_ack_value" name="IRS Monitoring Only Acknowledged" type="hidden" value="No">
          </div>

          <!-- Submit -->
          <div class="grid gap-3 md:grid-cols-2">
            <button
              type="submit"
              class="inline-flex w-full items-center justify-center rounded-xl bg-gradient-to-r from-amber-500 to-amber-600 px-4 py-3 text-sm font-semibold text-slate-950 hover:from-amber-400 hover:to-amber-500 transition"
            >Submit intake →</button>

            <a
              href="/site/pricing.html"
              class="inline-flex w-full items-center justify-center rounded-xl border border-slate-700/70 bg-slate-950/20 px-4 py-3 text-sm font-semibold text-slate-100 hover:bg-slate-950/35 transition"
            >View pricing</a>
          </div>

          <div id="tm-error" class="hidden rounded-xl border border-red-500/30 bg-red-500/10 px-4 py-3 text-sm text-red-200"></div>

          <div class="text-xs text-slate-500">
            After submission, this page redirects to <code class="text-slate-300">/app/offer.html</code>.
          </div>
        </form>
      </section>

      <div class="text-center text-sm text-slate-500">
        Monitoring does not create IRS representation. Representation, filing, and resolution are separate engagements.
      </div>
    </main>

    <!-- Footer (match offer.html) -->
    <footer class="border-t border-slate-800/60 mt-12 bg-slate-950/40">
      <div class="max-w-6xl mx-auto px-4 py-8 text-center text-xs text-slate-500">
        <div>© <span id="footer-year"></span> Tax Monitor Pro. All rights reserved.</div>
        <div class="mt-3 flex items-center justify-center gap-4">
          <a class="hover:text-slate-300 transition" href="/legal/privacy.html">Privacy</a>
          <a class="hover:text-slate-300 transition" href="/legal/terms.html">Terms</a>
        </div>
      </div>
    </footer>
  </div>

  <script>
    (function () {
      var y = document.getElementById('footer-year');
      if (y) y.textContent = String(new Date().getFullYear());
    })();
  </script>

  <!-- Common helpers (same on every page) -->
  <script>
    (function () {
      function getEndpointSlug(formEl) {
        try {
          var action = String(formEl.getAttribute('action') || '');
          var u = new URL(action, window.location.origin);
          var parts = (u.pathname || '').split('/').filter(Boolean);
          return String(parts[parts.length - 1] || 'form').trim() || 'form';
        } catch (e) {
          return 'form';
        }
      }

      function ensureEventId(formEl) {
        var el = document.getElementById('tm_event_id');
        if (!el) return;

        var endpoint = getEndpointSlug(formEl || document.querySelector('form'));
        var key = 'tm:' + endpoint + ':eventId';

        var existing = sessionStorage.getItem(key);
        if (!existing) {
          existing = (crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now());
          sessionStorage.setItem(key, existing);
        }
        el.value = existing;
      }

      function syncSessionToken() {
        var el = document.getElementById('tm_session_token');
        if (!el) return;

        var params = new URLSearchParams(window.location.search || '');
        var t = params.get('token') || params.get('sessionToken') || '';
        el.value = t;
      }

      function disableSubmit(formEl) {
        if (!formEl) return;

        var btn = formEl.querySelector('button[type="submit"]');
        if (!btn) return;

        btn.disabled = true;
        btn.setAttribute('aria-disabled', 'true');
        btn.dataset.originalText = btn.textContent || '';
        btn.textContent = 'Submitting...';
      }

      function showError(text) {
        var box = document.getElementById('tm-error');
        if (!box) return;
        box.textContent = String(text || 'Submission failed.');
        box.classList.remove('hidden');
      }

      function restoreSubmit(formEl) {
        if (!formEl) return;

        var btn = formEl.querySelector('button[type="submit"]');
        if (!btn) return;

        btn.disabled = false;
        btn.removeAttribute('aria-disabled');
        btn.textContent = btn.dataset.originalText || 'Submit';
      }

      window.tmCommon = {
        disableSubmit: disableSubmit,
        ensureEventId: ensureEventId,
        getEndpointSlug: getEndpointSlug,
        restoreSubmit: restoreSubmit,
        showError: showError,
        syncSessionToken: syncSessionToken
      };
    })();
  </script>

  <!-- Intake-specific mapping + submit via fetch + redirect -->
  <script>
    (function () {
      var ack = document.getElementById('monitoring_ack');
      var ackValue = document.getElementById('monitoring_ack_value');
      var concerns = Array.prototype.slice.call(document.querySelectorAll('.tm-concern'));
      var concernsValue = document.getElementById('primary_concern_value');
      var form = document.getElementById('tm-intake');

      function syncAck() {
        if (!ackValue) return;
        ackValue.value = ack && ack.checked ? 'Yes' : 'No';
      }

      function syncConcerns() {
        if (!concernsValue) return;
        var picked = [];
        for (var i = 0; i < concerns.length; i++) {
          if (concerns[i].checked) picked.push(String(concerns[i].value || '').trim());
        }
        concernsValue.value = picked.filter(Boolean).join(',');
      }

      if (ack) ack.addEventListener('change', syncAck);
      for (var i = 0; i < concerns.length; i++) concerns[i].addEventListener('change', syncConcerns);

      if (form) {
        form.addEventListener('submit', async function (e) {
          e.preventDefault();

          if (window.tmCommon) {
            window.tmCommon.ensureEventId(form);
            window.tmCommon.syncSessionToken();
          }

          syncAck();
          syncConcerns();

          if (window.tmCommon) window.tmCommon.disableSubmit(form);

          try {
            var res = await fetch(form.action, { method: 'POST', body: new FormData(form) });
            var data = {};
            try { data = await res.json(); } catch (err) {}

            if (res.ok && data && data.ok) {
              window.location.href = '/app/offer.html' + (window.location.search || '');
              return;
            }

            var msg = (data && (data.error || data.details)) ? (data.error || data.details) : 'Submission failed.';
            if (window.tmCommon) window.tmCommon.showError(msg);
            if (window.tmCommon) window.tmCommon.restoreSubmit(form);
          } catch (err) {
            if (window.tmCommon) window.tmCommon.showError(String(err && err.message ? err.message : err));
            if (window.tmCommon) window.tmCommon.restoreSubmit(form);
          }
        });
      }

      if (window.tmCommon) {
        window.tmCommon.ensureEventId(form);
        window.tmCommon.syncSessionToken();
      }
      syncAck();
      syncConcerns();
    })();
  </script>

  <!-- Flatpickr -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    (function () {
      var el = document.getElementById('irs_notice_date');
      if (!el || !window.flatpickr) return;

      window.flatpickr(el, {
        allowInput: true,
        dateFormat: "Y-m-d"
      });
    })();
  </script>
</body>
</html>

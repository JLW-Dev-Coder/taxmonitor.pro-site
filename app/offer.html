<!--/app/offer.html-->
<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tax Monitor Pro — Offer</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&amp;display=swap" rel="stylesheet">
  <style>
        * { font-family: 'DM Sans', sans-serif; }

        /* Aurora Background */
        .aurora-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            overflow: hidden;
            background: #020617;
        }

        .aurora-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            animation: aurora-float 20s ease-in-out infinite;
        }

        .aurora-blob-1 {
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, #f59e0b 0%, #ea580c 50%, #dc2626 100%);
            top: -200px;
            left: -100px;
            animation-delay: 0s;
        }

        .aurora-blob-2 {
            width: 500px;
            height: 500px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
            bottom: -150px;
            right: -100px;
            animation-delay: -7s;
        }

        .aurora-blob-3 {
            width: 400px;
            height: 400px;
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-delay: -14s;
        }

        @keyframes aurora-float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -30px) scale(1.05); }
            50% { transform: translate(-20px, 20px) scale(0.95); }
            75% { transform: translate(-30px, -20px) scale(1.02); }
        }

        /* Noise Overlay */
        .noise-overlay {
            position: fixed;
            inset: 0;
            z-index: -1;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            pointer-events: none;
        }

        /* Glass Cards */
        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(248, 250, 252, 0.1);
            border-radius: 16px;
        }

        .glass-card-light {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(248, 250, 252, 0.08);
            border-radius: 12px;
        }

        /* Gradient Border */
        .gradient-border {
            position: relative;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 16px;
        }

        .gradient-border::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 18px;
            background: linear-gradient(135deg, #f59e0b, #ea580c, #10b981);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .gradient-border.selected::before {
            opacity: 1;
        }

        /* Glow Effect */
        .glow-amber {
            box-shadow: 0 0 40px rgba(245, 158, 11, 0.3);
        }

        /* Shimmer Animation */
        .shimmer {
            position: relative;
            overflow: hidden;
        }

        .shimmer::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }

        /* Button Gradient */
        .btn-gradient {
            background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%);
            transition: all 0.3s ease;
        }

        .btn-gradient:hover {
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.5);
            transform: translateY(-2px);
        }

        /* Package Card */
        .package-card {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .package-card:hover {
            transform: translateY(-4px);
        }

        .package-card.selected {
            border-color: #f59e0b;
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.3);
        }

        /* Stepper */
        .step-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .step-circle.completed {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .step-circle.active {
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            color: white;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
        }

        .step-circle.upcoming {
            background: rgba(71, 85, 105, 0.5);
            color: #94a3b8;
        }

        .step-connector {
            width: 40px;
            height: 2px;
            background: rgba(71, 85, 105, 0.5);
            margin: 0 4px;
        }

        .step-connector.completed {
            background: linear-gradient(90deg, #10b981, #f59e0b);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(245, 158, 11, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(245, 158, 11, 0.5);
        }

        /* Toast Animation */
        @keyframes slide-up {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slide-up 0.3s ease-out; }
    </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full bg-slate-950 text-slate-100 overflow-auto">
  <!-- Aurora Background -->
  <div class="aurora-bg">
   <div class="aurora-blob aurora-blob-1"></div>
   <div class="aurora-blob aurora-blob-2"></div>
   <div class="aurora-blob aurora-blob-3"></div>
  </div>
  <div class="noise-overlay"></div>

  <!-- Hidden contract fields (Offer form) -->
  <form id="tm-offer" class="hidden" action="https://api.taxmonitor.pro/forms/offer" method="POST" novalidate>
    <input type="hidden" name="accountId" id="accountId" value="" />
    <input type="hidden" name="code" id="code" value="" />
    <input type="hidden" name="eventId" id="eventId" value="" />
    <input type="hidden" name="item" id="item" value="" />
    <input type="hidden" name="orderId" id="orderId" value="" />
    <input type="hidden" name="sessionToken" id="sessionToken" value="" />
    <input type="hidden" name="viewport" id="viewport" value="" />
  </form>

  <!-- Main Container -->
  <div class="min-h-full flex flex-col">

   <!-- Header (match intake.html header) -->
   <header class="sticky top-0 z-50 glass-card border-b border-slate-800/60">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-4">
      <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
        <!-- Brand -->
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center">
            <span class="font-black text-slate-950">TM</span>
          </div>
          <div>
            <div class="font-bold text-slate-100">Tax Monitor Pro</div>
            <div class="text-xs text-slate-400">Offer</div>
          </div>
        </div>

        <!-- Stepper -->
        <div class="flex items-center gap-2 sm:gap-4">
          <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-emerald-600 flex items-center justify-center">
              <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            </div>
            <span class="text-sm font-semibold text-emerald-400">Intake</span>
          </div>

          <div class="w-8 h-0.5 bg-slate-700"></div>

          <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-amber-500 flex items-center justify-center shadow-lg shadow-amber-500/30">
              <span class="text-xs font-bold text-slate-950">2</span>
            </div>
            <span class="text-sm font-semibold text-amber-400">Offer</span>
          </div>

          <div class="w-8 h-0.5 bg-slate-700"></div>

          <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center">
              <span class="text-xs text-slate-400">3</span>
            </div>
            <span class="text-sm text-slate-500 hidden sm:inline">Agreement</span>
          </div>

          <div class="w-8 h-0.5 bg-slate-700"></div>

          <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center">
              <span class="text-xs text-slate-400">4</span>
            </div>
            <span class="text-sm text-slate-500 hidden sm:inline">Payment</span>
          </div>
        </div>

        <!-- Back -->
        <a
          href="/app/index.html"
          class="inline-flex items-center gap-2 rounded-full border border-slate-800/70 bg-black/20 px-3 py-1.5 text-xs font-semibold text-slate-300 hover:text-amber-300 hover:border-amber-500/30"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          Back
        </a>
      </div>

      <!-- Progress bar (step 2 of 4) -->
      <div class="mt-4 h-1 bg-slate-900/60 rounded-full overflow-hidden">
        <div class="h-full w-2/4 rounded-full" style="background: linear-gradient(90deg, #f59e0b, #d97706); box-shadow: 0 0 20px rgba(245,158,11,0.45);"></div>
      </div>
    </div>
   </header>

   <!-- Main Content -->
   <main class="flex-1 px-4 py-8">
    <div class="max-w-4xl mx-auto space-y-8">

     <!-- Hero Summary Card (do not change this section title block) -->
     <div class="glass-card p-8 text-center">
      <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-amber-500/10 border border-amber-500/20 mb-6">
       <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg>
       <span class="text-amber-400 font-medium text-sm">Personalized Proposal Ready</span>
      </div>
      <h1 id="hero-title" class="text-3xl md:text-4xl font-bold mb-4 bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent">Your Tax Resolution Offer</h1>
      <p id="hero-subtitle" class="text-slate-400 text-lg max-w-2xl mx-auto">Hello <span id="client-name" class="text-amber-400 font-semibold">John</span>, based on your unique tax situation, we've prepared a customized resolution plan designed to help you achieve financial peace of mind.</p>
     </div>

     <!-- Choose Your Package Section -->
     <div class="space-y-6">
      <div class="text-center">
       <h2 class="text-2xl font-bold text-white mb-2">Choose Your Package</h2>
       <p class="text-slate-400">Select the monitoring level that fits your needs</p>
      </div>

      <!-- Term Plans -->
      <div class="grid md:grid-cols-3 gap-6" id="packages-container">

       <!-- Bronze -->
       <div class="package-card glass-card p-6 border-2 border-transparent" data-package="bronze" onclick="selectPackage('bronze')" role="button" tabindex="0">
        <div class="text-center mb-6">
         <span class="inline-block px-3 py-1 rounded-full text-xs font-medium bg-slate-700 text-slate-300 mb-3">BRONZE</span>
         <div class="text-4xl font-bold text-white mb-1">$275</div>
         <div class="text-slate-400 text-sm">6-week plan</div>
        </div>
        <ul class="space-y-3 mb-6">
         <li class="flex items-start gap-3 text-sm text-slate-300">
          <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
          Monitoring during the plan term
         </li>
         <li class="flex items-start gap-3 text-sm text-slate-300">
          <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
          Plain-English updates
         </li>
         <li class="flex items-start gap-3 text-sm text-slate-300">
          <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
          Basic alerting for major changes
         </li>
        </ul>
        <div class="text-center"><span class="text-slate-500 text-sm">Best for short-term visibility</span></div>
       </div>

       <!-- Silver -->
       <div class="package-card glass-card p-6 border-2 border-transparent relative" data-package="silver" onclick="selectPackage('silver')" role="button" tabindex="0">
        <div class="absolute -top-3 left-1/2 -translate-x-1/2">
         <span class="px-4 py-1 rounded-full text-xs font-bold bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-lg">MOST POPULAR</span>
        </div>
        <div class="text-center mb-6 mt-2">
         <span class="inline-block px-3 py-1 rounded-full text-xs font-medium bg-amber-500/20 text-amber-400 mb-3">SILVER</span>
         <div class="text-4xl font-bold text-white mb-1">$325</div>
         <div class="text-slate-400 text-sm">8-week plan</div>
        </div>
        <ul class="space-y-3 mb-6">
         <li class="flex items-start gap-3 text-sm text-slate-300">
          <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
          Everything in Bronze
         </li>
         <li class="flex items-start gap-3 text-sm text-slate-300">
          <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
          More frequent monitoring
         </li>
         <li class="flex items-start gap-3 text-sm text-slate-300">
          <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
          Deeper alerting for common changes
         </li>
        </ul>
        <div class="text-center"><span class="text-amber-400 text-sm font-medium">Recommended for most clients</span></div>
       </div>

       <!-- Gold -->
       <div class="package-card glass-card p-6 border-2 border-transparent" data-package="gold" onclick="selectPackage('gold')" role="button" tabindex="0">
        <div class="text-center mb-6">
         <span class="inline-block px-3 py-1 rounded-full text-xs font-medium bg-emerald-500/20 text-emerald-400 mb-3">GOLD</span>
         <div class="text-4xl font-bold text-white mb-1">$425</div>
         <div class="text-slate-400 text-sm">12-week plan</div>
        </div>
        <ul class="space-y-3 mb-6">
         <li class="flex items-start gap-3 text-sm text-slate-300">
          <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
          Everything in Silver
         </li>
         <li class="flex items-start gap-3 text-sm text-slate-300">
          <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
          Longest term coverage
         </li>
         <li class="flex items-start gap-3 text-sm text-slate-300">
          <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
          Highest alerting depth
         </li>
        </ul>
        <div class="text-center"><span class="text-emerald-400 text-sm font-medium">Best for ongoing visibility</span></div>
       </div>

      </div>

      <!-- Add-ons -->
      <div class="grid md:grid-cols-2 gap-6">
       <div class="package-card glass-card p-6 border-2 border-transparent" data-package="one_time" onclick="selectPackage('one_time')" role="button" tabindex="0">
        <div class="flex items-start justify-between gap-4">
         <div>
          <div class="text-lg font-bold text-white">One-Time Snapshot</div>
          <div class="mt-1 text-sm text-slate-400">Best for a quick baseline check</div>
         </div>
         <div class="text-right">
          <div class="text-3xl font-extrabold text-white">$299</div>
          <div class="text-xs text-slate-400">one-time</div>
         </div>
        </div>
        <div class="mt-5 rounded-xl bg-slate-950/40 border border-slate-800 p-4 text-sm text-slate-300">
         <div class="font-semibold mb-2">Includes</div>
         <ul class="space-y-2 text-slate-400">
          <li>• Initial transcript pull + baseline summary</li>
          <li>• One status update</li>
          <li>• No ongoing monitoring term</li>
         </ul>
        </div>
       </div>

       <div class="package-card glass-card p-6 border-2 border-transparent" data-package="mfj" onclick="selectPackage('mfj')" role="button" tabindex="0">
        <div class="flex items-start justify-between gap-4">
         <div>
          <div class="text-lg font-bold text-white">MFJ Add-On</div>
          <div class="mt-1 text-sm text-slate-400">Enables MFJ-year monitoring visibility</div>
         </div>
         <div class="text-right">
          <div class="text-3xl font-extrabold text-white">+$79</div>
          <div class="text-xs text-slate-400">add-on</div>
         </div>
        </div>
        <div class="mt-5 rounded-xl bg-slate-950/40 border border-slate-800 p-4 text-sm text-slate-300">
         <div class="font-semibold mb-2">Applies to</div>
         <ul class="space-y-2 text-slate-400">
          <li>• Any term plan (Bronze, Gold, Silver)</li>
          <li>• Each spouse must enroll independently</li>
          <li>• MFJ visibility requires both spouses enrolled + authorized</li>
         </ul>
        </div>
       </div>
      </div>
     </div>

     <!-- Selected Package Summary -->
     <div id="package-summary" class="glass-card p-6 border border-amber-500/30 hidden">
      <div class="flex items-center gap-3 mb-4">
       <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg>
       </div>
       <div>
        <h3 class="text-lg font-semibold text-white">Selected Package</h3>
        <p class="text-slate-400 text-sm">Your chosen monitoring level</p>
       </div>
      </div>
      <div class="grid md:grid-cols-3 gap-4">
       <div class="glass-card-light p-4 text-center">
        <div class="text-slate-400 text-sm mb-1">Package</div>
        <div id="summary-package" class="text-amber-400 font-bold text-lg">—</div>
       </div>
       <div class="glass-card-light p-4 text-center">
        <div class="text-slate-400 text-sm mb-1">Price</div>
        <div id="summary-price" class="text-white font-bold text-lg">—</div>
       </div>
       <div class="glass-card-light p-4 text-center">
        <div class="text-slate-400 text-sm mb-1">Term</div>
        <div id="summary-term" class="text-emerald-400 font-bold text-lg">—</div>
       </div>
      </div>
      <div class="mt-4 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20">
       <p class="text-amber-400 text-sm flex items-start gap-2">
        <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        <span id="mfj-note">Monitoring is not IRS representation. If MFJ years apply, each spouse must enroll and authorize independently for joint-year visibility.</span>
       </p>
      </div>
     </div>

     <!-- What's Included / Not Included -->
     <div class="grid md:grid-cols-2 gap-6">
      <div class="glass-card p-6">
       <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center">
         <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
        </div>
        <h3 class="text-xl font-bold text-white">What's Included</h3>
       </div>
       <ul class="space-y-4">
        <li class="flex items-start gap-3">
         <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
         <div>
          <div class="text-white font-medium">Authorized account monitoring</div>
          <div class="text-slate-400 text-sm">We monitor available IRS account signals during your plan term.</div>
         </div>
        </li>
        <li class="flex items-start gap-3">
         <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
         <div>
          <div class="text-white font-medium">Plain-English updates</div>
          <div class="text-slate-400 text-sm">What changed, why it matters, and what to do next.</div>
         </div>
        </li>
        <li class="flex items-start gap-3">
         <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
         <div>
          <div class="text-white font-medium">Client portal visibility</div>
          <div class="text-slate-400 text-sm">Your monitoring timeline and notes live in your portal.</div>
         </div>
        </li>
        <li class="flex items-start gap-3">
         <svg class="w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
         <div>
          <div class="text-white font-medium">Alerts for major changes</div>
          <div class="text-slate-400 text-sm">We flag common IRS account changes that deserve attention.</div>
         </div>
        </li>
       </ul>
      </div>

      <div class="glass-card p-6">
       <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 rounded-xl bg-red-500/20 flex items-center justify-center">
         <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </div>
        <h3 class="text-xl font-bold text-white">What's Not Included</h3>
       </div>
       <ul class="space-y-4">
        <li class="flex items-start gap-3">
         <svg class="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
         <div>
          <div class="text-white font-medium">IRS representation</div>
          <div class="text-slate-400 text-sm">Monitoring does not create representation. Representation requires a separate signed engagement and Form 2848.</div>
         </div>
        </li>
        <li class="flex items-start gap-3">
         <svg class="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
         <div>
          <div class="text-white font-medium">Tax returns or filings</div>
          <div class="text-slate-400 text-sm">Preparation, filing, and amendments are separate services.</div>
         </div>
        </li>
        <li class="flex items-start gap-3">
         <svg class="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
         <div>
          <div class="text-white font-medium">Negotiations or resolution work</div>
          <div class="text-slate-400 text-sm">Installment agreements, OIC, appeals, and collections work require a separate written contract.</div>
         </div>
        </li>
        <li class="flex items-start gap-3">
         <svg class="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
         <div>
          <div class="text-white font-medium">Payments to the IRS</div>
          <div class="text-slate-400 text-sm">Any tax due, penalties, or settlement amounts remain your responsibility.</div>
         </div>
        </li>
       </ul>
      </div>
     </div>

     <!-- How It Works -->
     <div class="glass-card p-6">
      <div class="text-center mb-8">
       <h2 class="text-2xl font-bold text-white mb-2">How It Works</h2>
       <p class="text-slate-400">A straightforward monitoring workflow</p>
      </div>
      <div class="grid md:grid-cols-3 gap-6">
       <div class="glass-card-light p-6 text-center">
        <div class="w-14 h-14 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-600/20 flex items-center justify-center"><span class="text-2xl font-bold text-amber-400">1</span></div>
        <h3 class="text-lg font-semibold text-white mb-2">Confirm &amp; Activate</h3>
        <p class="text-slate-400 text-sm">You complete intake. We confirm the right plan and activate monitoring once authorized access is available.</p>
       </div>
       <div class="glass-card-light p-6 text-center">
        <div class="w-14 h-14 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-600/20 flex items-center justify-center"><span class="text-2xl font-bold text-amber-400">2</span></div>
        <h3 class="text-lg font-semibold text-white mb-2">Monitor &amp; Flag Changes</h3>
        <p class="text-slate-400 text-sm">We track meaningful IRS account changes and post plain-English updates inside your portal.</p>
       </div>
       <div class="glass-card-light p-6 text-center">
        <div class="w-14 h-14 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-green-600/20 flex items-center justify-center"><span class="text-2xl font-bold text-emerald-400">3</span></div>
        <h3 class="text-lg font-semibold text-white mb-2">Deliver Next Steps</h3>
        <p class="text-slate-400 text-sm">If something requires action, we tell you what it is and what options exist, without pretending monitoring is representation.</p>
       </div>
      </div>
     </div>

     <!-- Important Notice -->
     <div class="glass-card p-6 border border-amber-500/30">
      <div class="flex items-start gap-4">
       <div class="w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center flex-shrink-0">
        <svg class="w-6 h-6 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
       </div>
       <div>
        <h3 class="text-lg font-bold text-amber-400 mb-2">Important Notice</h3>
        <p class="text-slate-300 leading-relaxed">Approving this offer selects your monitoring plan. Monitoring is informational and does not create IRS representation. If you later need representation, resolution work, or negotiations, that requires a separate written agreement and (when applicable) Form 2848.</p>
       </div>
      </div>
     </div>

     <!-- Approval Panel -->
     <div class="glass-card p-8 glow-amber">
      <div class="text-center mb-6">
       <h2 class="text-2xl font-bold text-white mb-2">Review &amp; Approve</h2>
       <p class="text-slate-400">Ready to move to the service agreement?</p>
      </div>
      <div class="glass-card-light p-4 mb-6">
       <div class="flex items-center gap-3">
        <svg class="w-5 h-5 text-emerald-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
        <p class="text-slate-300 text-sm">Your information is protected. We don’t share your data with third parties except as needed to deliver the service.</p>
       </div>
      </div>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <button id="approve-btn" class="btn-gradient px-8 py-4 rounded-xl text-white font-bold text-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled onclick="handleApprove()">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
          Approve Offer
        </button>
        <button id="continue-btn" class="px-8 py-4 rounded-xl border border-slate-600 text-slate-300 font-medium hover:bg-slate-800 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled onclick="handleProceed()">
          Continue to Agreement
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
        </button>
      </div>
      <div id="form-error" class="hidden mt-5 rounded-xl border border-red-500/30 bg-red-500/10 px-4 py-3 text-sm text-red-200"></div>
     </div>

    </div>
   </main>

   <!-- Footer -->
   <footer class="glass-card mx-4 mb-4 px-6 py-4">
    <div class="max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
     <p class="text-slate-500 text-sm">© <span id="footer-year"></span> Tax Monitor Pro. All rights reserved.</p>
     <div class="flex items-center gap-6">
       <a href="/legal/privacy.html" class="text-slate-400 hover:text-amber-400 text-sm transition-colors">Privacy Policy</a>
       <a href="/legal/terms.html" class="text-slate-400 hover:text-amber-400 text-sm transition-colors">Terms of Service</a>
       <a href="/site/contact.html" class="text-slate-400 hover:text-amber-400 text-sm transition-colors">Contact Support</a>
     </div>
    </div>
   </footer>

  </div>

  <script>
    (function () {
      var y = document.getElementById('footer-year');
      if (y) y.textContent = String(new Date().getFullYear());
    })();
  </script>

  <script>
        // Default configuration
        const defaultConfig = {
            accent_color: '#f59e0b',
            background_color: '#020617',
            client_name: 'John',
            hero_subtitle: 'Personalized solution based on your situation',
            hero_title: 'Your Tax Resolution Offer',
            selected_package: '',
            text_color: '#f1f5f9'
        };

        let config = { ...defaultConfig };
        let selectedPackage = null;

        const packages = {
            bronze: { name: 'Bronze', price: '$275', term: '6 Weeks' },
            gold: { name: 'Gold', price: '$425', term: '12 Weeks' },
            mfj: { name: 'MFJ Add-On', price: '+$79', term: 'Add-on' },
            one_time: { name: 'One-Time Snapshot', price: '$299', term: 'One-time' },
            silver: { name: 'Silver', price: '$325', term: '8 Weeks' }
        };

        function safeText(v) {
          return String(v || '').replace(/[<>]/g, '').trim();
        }

        function ensureHiddenFields() {
          const params = new URLSearchParams(window.location.search || '');

          const code = safeText(params.get('code') || '');
          const accountId = safeText(params.get('accountId') || '');
          const orderId = safeText(params.get('orderId') || '');
          const sessionTokenQ = safeText(params.get('sessionToken') || '');
          const eventIdQ = safeText(params.get('eventId') || '');

          document.getElementById('code').value = code;
          document.getElementById('accountId').value = accountId;
          document.getElementById('orderId').value = orderId;
          document.getElementById('viewport').value = String(window.innerWidth || '');

          // eventId: prefer querystring, then crypto UUID
          document.getElementById('eventId').value = eventIdQ || ((window.crypto && crypto.randomUUID) ? crypto.randomUUID() : (Date.now() + '-' + Math.random().toString(16).slice(2)));

          // sessionToken: prefer querystring, then localStorage
          const st = sessionTokenQ || safeText(localStorage.getItem('tm_sessionToken') || '');
          document.getElementById('sessionToken').value = st;

          // client name display (cosmetic)
          const clientNameEl = document.getElementById('client-name');
          const nm = safeText(params.get('clientFirstName') || params.get('firstName') || params.get('first_name') || '');
          if (clientNameEl && nm) clientNameEl.textContent = nm;

          return { code, sessionToken: st };
        }

        function setError(msg) {
          const box = document.getElementById('form-error');
          if (!box) return;
          box.textContent = String(msg || 'Something went wrong.');
          box.classList.remove('hidden');
        }

        function clearError() {
          const box = document.getElementById('form-error');
          if (!box) return;
          box.classList.add('hidden');
          box.textContent = '';
        }

        function setButtons({ approveDisabled, continueDisabled }) {
          const approveBtn = document.getElementById('approve-btn');
          const continueBtn = document.getElementById('continue-btn');
          if (approveBtn) approveBtn.disabled = !!approveDisabled;
          if (continueBtn) continueBtn.disabled = !!continueDisabled;
        }

        function selectPackage(packageId) {
            selectedPackage = packageId;

            // Update UI for all package cards
            document.querySelectorAll('.package-card').forEach(card => {
                const cardPackage = card.dataset.package;
                if (cardPackage === packageId) {
                    card.classList.add('selected', 'shimmer', 'glow-amber');
                    card.style.borderColor = '#f59e0b';
                } else {
                    card.classList.remove('selected', 'shimmer', 'glow-amber');
                    card.style.borderColor = 'transparent';
                }
            });

            // Update summary
            const summary = document.getElementById('package-summary');
            const pkg = packages[packageId];

            if (summary && pkg) {
              summary.classList.remove('hidden');
              document.getElementById('summary-package').textContent = pkg.name;
              document.getElementById('summary-price').textContent = pkg.price;
              document.getElementById('summary-term').textContent = pkg.term;
            }

            // Set hidden item
            document.getElementById('item').value = packageId;

            // Enable approve button (continue remains disabled until approve succeeds)
            setButtons({ approveDisabled: false, continueDisabled: true });

            // Update config
            if (window.elementSdk) {
                window.elementSdk.setConfig({ selected_package: packageId });
            }
        }

        async function handleApprove() {
            clearError();
            if (!selectedPackage) return;

            const approveBtn = document.getElementById('approve-btn');
            const continueBtn = document.getElementById('continue-btn');
            const originalApprove = approveBtn ? approveBtn.innerHTML : '';

            const { code, sessionToken } = ensureHiddenFields();

            if (!code) {
              setError('Missing code. Return to the start and retry.');
              return;
            }
            if (!sessionToken) {
              setError('Missing sessionToken. Return to the start and retry.');
              return;
            }

            setButtons({ approveDisabled: true, continueDisabled: true });

            if (approveBtn) {
              approveBtn.innerHTML = `
                <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24" aria-hidden="true">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Processing...
              `;
            }

            try {
              const form = document.getElementById('tm-offer');
              if (!form) throw new Error('Offer form missing.');

              // Make sure latest values are present
              ensureHiddenFields();

              const res = await fetch(form.action, {
                method: 'POST',
                body: new FormData(form)
              });

              let data = null;
              try { data = await res.json(); } catch (_) {}

              if (!res.ok || (data && data.ok === false)) {
                const msg = (data && (data.error || data.details)) ? (data.error || data.details) : 'Offer submission failed.';
                throw new Error(safeText(msg).slice(0, 240));
              }

              if (approveBtn) {
                approveBtn.innerHTML = `
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                  Approved
                `;
                approveBtn.classList.add('bg-emerald-600');
                approveBtn.classList.remove('btn-gradient');
              }

              if (continueBtn) continueBtn.disabled = false;
              showToast('Offer saved. Continue to agreement.', 'success');

              // Persist token for subsequent steps
              try { localStorage.setItem('tm_sessionToken', sessionToken); } catch (_) {}

            } catch (err) {
              if (approveBtn) approveBtn.innerHTML = originalApprove;
              setButtons({ approveDisabled: false, continueDisabled: true });
              setError((err && err.message) ? err.message : 'Something went wrong.');
            }
        }

        function handleProceed() {
            clearError();

            const code = safeText(document.getElementById('code').value);
            const item = safeText(document.getElementById('item').value);
            const accountId = safeText(document.getElementById('accountId').value);
            const orderId = safeText(document.getElementById('orderId').value);
            const sessionToken = safeText(document.getElementById('sessionToken').value);

            if (!code || !item) {
              setError('Missing code or selected package.');
              return;
            }

            const u = new URL('/app/agreement.html', window.location.origin);
            u.searchParams.set('code', code);
            u.searchParams.set('item', item);
            if (accountId) u.searchParams.set('accountId', accountId);
            if (orderId) u.searchParams.set('orderId', orderId);
            if (sessionToken) u.searchParams.set('sessionToken', sessionToken);
            window.location.href = u.toString();
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-6 py-4 rounded-xl shadow-lg z-50 flex items-center gap-3 animate-slide-up ${
                type === 'success' ? 'bg-emerald-600' : 'bg-slate-700'
            }`;
            toast.innerHTML = `
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    ${type === 'success'
                        ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>'
                        : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>'
                    }
                </svg>
                <span class="text-white font-medium">${safeText(message)}</span>
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Element SDK integration
        async function onConfigChange(newConfig) {
            config = { ...defaultConfig, ...newConfig };

            // Update client name
            const clientNameEl = document.getElementById('client-name');
            if (clientNameEl) {
                clientNameEl.textContent = config.client_name || defaultConfig.client_name;
            }

            // Update hero title
            const heroTitleEl = document.getElementById('hero-title');
            if (heroTitleEl) {
                heroTitleEl.textContent = config.hero_title || defaultConfig.hero_title;
            }

            // Update hero subtitle (preserve client name span)
            const heroSubtitleEl = document.getElementById('hero-subtitle');
            if (heroSubtitleEl) {
                heroSubtitleEl.innerHTML = `Hello <span id="client-name" class="text-amber-400 font-semibold">${safeText(config.client_name || defaultConfig.client_name)}</span>, ${safeText(config.hero_subtitle || defaultConfig.hero_subtitle)}`;
            }

            // Restore selected package if any
            if (config.selected_package && packages[config.selected_package]) {
                selectPackage(config.selected_package);
            }
        }

        function mapToCapabilities(config) {
            return {
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined,
                recolorables: [
                    {
                        get: () => config.accent_color || defaultConfig.accent_color,
                        set: (value) => {
                            config.accent_color = value;
                            window.elementSdk.setConfig({ accent_color: value });
                        }
                    },
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            config.background_color = value;
                            window.elementSdk.setConfig({ background_color: value });
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            config.text_color = value;
                            window.elementSdk.setConfig({ text_color: value });
                        }
                    }
                ]
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ['client_name', config.client_name || defaultConfig.client_name],
                ['hero_subtitle', config.hero_subtitle || defaultConfig.hero_subtitle],
                ['hero_title', config.hero_title || defaultConfig.hero_title]
            ]);
        }

        // Initialize
        (function init() {
          const { code, sessionToken } = ensureHiddenFields();
          if (!code || !sessionToken) {
            setButtons({ approveDisabled: true, continueDisabled: true });
            setError('Missing required code/sessionToken in the URL.');
          }

          // Keyboard accessibility for cards
          document.querySelectorAll('.package-card').forEach(function (card) {
            card.addEventListener('keydown', function (e) {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                const id = card.dataset.package;
                if (id) selectPackage(id);
              }
            });
          });
        })();

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                mapToCapabilities,
                mapToEditPanelValues,
                onConfigChange
            });
        }
    </script>
 </body>
</html>
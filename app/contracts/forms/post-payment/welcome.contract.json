{
  "clickupProjection": [
    {
      "list": "Orders",
      "updates": [
        { "fieldName": "Order Token", "from": "effects.ordersPatch.sessionToken" }
      ]
    }
  ],
  "contract": {
    "authority": ["R2 Canonical"],
    "governs": "Form Ingestion — Post-Payment — Welcome Submitted → Orders Canonical → ClickUp Projection",
    "path": "app/contracts/forms/post-payment/welcome.contract.json",
    "source": "Tax Monitor Pro",
    "title": "Tax Monitor Pro — Post-Payment — Welcome Submitted",
    "validation": {
      "enumStrict": true,
      "normalizeCheckboxToBoolean": true,
      "rejectUnknownValues": true
    },
    "version": 2
  },
  "delivery": {
    "dedupeKey": "eventId",
    "endpoint": "https://api.taxmonitor.pro/forms/post-payment/welcome",
    "eventType": "WELCOME_SUBMITTED",
    "method": "POST",
    "receiptKeyPattern": "receipts/{source}/{eventId}.json",
    "receiptSource": "form",
    "writes": ["orders"]
  },
  "effects": {
    "ordersPatch": {
      "postPayment": {
        "additionalInfo": "{payload.additionalInfo}",
        "availableDays": "{payload.availableDays}",
        "confirmationMethod": "{payload.confirmationMethod}",
        "minimumNotice": "{payload.minimumNotice}",
        "phoneNumber": "{payload.phoneNumber}",
        "preferredContactMethod": "{payload.preferredContactMethod}",
        "timeWindow": "{payload.timeWindow}",
        "timezone": "{payload.timezone}"
      },
      "sessionToken": "{payload.sessionToken}",
      "stepBooleans": {
        "welcomeConfirmed": true
      }
    }
  },
  "payload": {
    "type": "object",
    "properties": {
      "additionalInfo": { "type": "string", "maxLength": 8000 },
      "availableDays": {
        "type": "array",
        "items": {
          "type": "string",
          "enum": ["fri", "mon", "thu", "tue", "wed"]
        }
      },
      "confirmationMethod": {
        "type": "string",
        "enum": ["email", "phone", "portal"]
      },
      "eventId": {
        "type": "string",
        "minLength": 8
      },
      "minimumNotice": {
        "type": "string",
        "enum": ["24h", "48h", "72h_plus", "same_day"]
      },
      "orderId": {
        "type": "string",
        "minLength": 8
      },
      "phoneNumber": {
        "type": "string",
        "minLength": 10
      },
      "preferredContactMethod": {
        "type": "string",
        "enum": ["email", "phone", "portal"]
      },
      "sessionToken": {
        "type": "string",
        "minLength": 8
      },
      "timeWindow": {
        "type": "string",
        "enum": ["afternoon", "evening", "midday", "morning"]
      },
      "timezone": {
        "type": "string",
        "enum": ["CT", "ET", "MT", "PT"]
      }
    },
    "required": [
      "eventId",
      "orderId",
      "preferredContactMethod",
      "sessionToken"
    ],
    "allOf": [
      {
        "if": {
          "properties": {
            "preferredContactMethod": { "const": "phone" }
          }
        },
        "then": {
          "required": ["phoneNumber"]
        }
      }
    ]
  },
  "schema": {
    "name": "tm_form_post_payment_welcome",
    "version": 2
  }
}